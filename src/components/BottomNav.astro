---
import NavIcon from '@/components/NavIcon.astro';

const pathname = Astro.url.pathname;

const navItems: Array<{ href: string; label: string; icon: 'home' | 'blog' | 'resume'; external?: boolean }> = [
  { href: '/', label: 'Home', icon: 'home' },
  { href: '/blog', label: 'Blog', icon: 'blog' },
  { href: '/resume.pdf', label: 'Resume', icon: 'resume', external: true },
];

function isActive(href: string, currentPath: string): boolean {
  if (href === '/') return currentPath === '/';
  return currentPath.startsWith(href);
}
---

<nav
  class="fixed bottom-0 left-0 right-0 z-50 flex justify-center"
  style="padding-bottom: env(safe-area-inset-bottom, 0px);"
  aria-label="Main navigation"
>
  <ul class="nav-pill">
    {navItems.map((item) => {
      const active = !item.external && isActive(item.href, pathname);
      const ariaLabel = item.external ? `${item.label} (opens in a new tab)` : item.label;
      return (
        <li>
          <a
            href={item.href}
            class:list={[
              'nav-item',
              { 'nav-item--active': active },
            ]}
            aria-label={ariaLabel}
            aria-current={active ? 'page' : undefined}
            target={item.external ? '_blank' : undefined}
            rel={item.external ? 'noopener noreferrer' : undefined}
          >
            <span class="nav-icon" aria-hidden="true">
              <NavIcon name={item.icon} />
            </span>
            <span class="nav-label">{item.label}</span>
          </a>
        </li>
      );
    })}
  </ul>
</nav>

<style>
  .nav-pill {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    list-style: none;
    padding: 0.375rem 0.5rem;
    margin: 0;
    margin-bottom: 0.75rem;
    background: color-mix(in srgb, var(--color-bg-surface) 88%, transparent);
    backdrop-filter: blur(6px) saturate(120%);
    -webkit-backdrop-filter: blur(6px) saturate(120%);
    border: 1px solid var(--color-border-subtle);
    border-radius: 9999px;
    box-shadow:
      0 6px 20px rgba(0, 0, 0, 0.24),
      0 0 0 1px rgba(255, 255, 255, 0.04) inset,
      0 0 0 1px color-mix(in srgb, var(--color-accent) 14%, transparent);
  }

  @supports not (backdrop-filter: blur(1px)) {
    .nav-pill {
      background: var(--color-bg-surface);
    }
  }

  @media (max-width: 768px), (pointer: coarse) {
    .nav-pill {
      backdrop-filter: none;
      -webkit-backdrop-filter: none;
      background: var(--color-bg-surface);
    }
  }

  .nav-item {
    display: flex;
    align-items: center;
    gap: 0.375rem;
    padding: 0.4rem 0.75rem;
    border-radius: 9999px;
    font-family: var(--font-mono);
    font-size: 0.7rem;
    letter-spacing: 0.04em;
    text-transform: uppercase;
    color: var(--color-text-secondary);
    text-decoration: none;
    transition: color 0.2s, background-color 0.2s;
    white-space: nowrap;
  }

  .nav-item:hover {
    color: var(--color-text);
    background-color: color-mix(in srgb, var(--color-bg-raised) 82%, var(--color-accent-muted));
  }

  .nav-item--active {
    color: var(--color-text);
    background-color: color-mix(in srgb, var(--color-bg-raised) 64%, var(--color-accent));
  }

  .nav-item--active:hover {
    color: var(--color-text);
    background-color: color-mix(in srgb, var(--color-bg-raised) 56%, var(--color-accent));
  }

  .nav-item:focus-visible {
    background-color: var(--color-bg-raised);
    color: var(--color-text-secondary);
  }

  .nav-icon {
    display: flex;
    align-items: center;
    flex-shrink: 0;
  }

  .nav-label {
    font-weight: 500;
  }

  @media (max-width: 380px) {
    .nav-label {
      display: none;
    }
    .nav-item {
      padding: 0.5rem;
    }
  }
</style>
